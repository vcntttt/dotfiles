#!/usr/bin/env bash
# Focus an existing window or launch it if not running

if [[ $# -lt 1 ]]; then
  echo "Usage: launch-or-focus <window-pattern> [launch-command]"
  exit 1
fi

WINDOW_PATTERN="$1"
LAUNCH_COMMAND="${2:-$1}"

WINDOW_ADDRESS=$(hyprctl clients -j | jq -r \
  --arg p "$WINDOW_PATTERN" '
  .[] |
  select(
    (.class | test("\\b"+$p+"\\b"; "i")) or
    (.title | test("\\b"+$p+"\\b"; "i"))
  ) |
  .address
' | head -n1)

if [[ -n "$WINDOW_ADDRESS" ]]; then
  hyprctl dispatch focuswindow "address:$WINDOW_ADDRESS"
else
  eval exec setsid $LAUNCH_COMMAND
fi
