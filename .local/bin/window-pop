#!/usr/bin/env bash
# Toggle floating "pop-out" behavior for the active window

width=${1:-1300}
height=${2:-900}
x=${3:-}
y=${4:-}

active=$(hyprctl activewindow -j)
addr=$(echo "$active" | jq -r '.address')
pinned=$(echo "$active" | jq -r '.pinned')

[[ -z "$addr" ]] && exit 0

if [[ "$pinned" == "true" ]]; then
  hyprctl -q --batch \
    "dispatch pin address:$addr;" \
    "dispatch togglefloating address:$addr;" \
    "dispatch tagwindow -pop address:$addr;"
else
  hyprctl dispatch togglefloating address:$addr
  hyprctl dispatch resizeactive exact "$width" "$height" address:$addr

  if [[ -n "$x" && -n "$y" ]]; then
    hyprctl dispatch moveactive "$x" "$y" address:$addr
  else
    hyprctl dispatch centerwindow address:$addr
  fi

  hyprctl -q --batch \
    "dispatch pin address:$addr;" \
    "dispatch alterzorder top address:$addr;" \
    "dispatch tagwindow +pop address:$addr;"
fi
